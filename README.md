**可执行的交易决策 agent（决策端） + 你作为“下单机器人”（执行端）**的体系。我会把设计写得够工程化、可落地、并给出一个最小可行样例（MVP）供你直接拿去跑或改。话少说，下面是完整方案——结构、规则、接口、示例代码骨架、回测和风控，以及交付物清单。请务必在实际下单前用历史数据回测并在模拟账户里跑够样本，否则把钱当测试集是个坏主意（你会输得干净利落）。

一、总体架构（高层）

数据层

行情与历史K线：tushare/akshare/券商API/主流数据源。

资金流/龙虎榜/换手率/新闻（可选）：同花顺、东方财富、公开公告抓取。

实时分时与成交（若做日内或盘口策略）：券商实时推送或行情接口。

决策层（agent） — 我负责设计、你执行

扫描模块（Universe 列表 + 筛选器）

信号引擎（多因子 + 事件驱动）

组合构建器（仓位分配）

风控检查器（单股/组合/日内/回撤/熔断规则）

指令生成器（限价/市价/分步下单等）

日志与告警（每笔交易 + 状态汇总）

执行层（由你 — 人工或机械化下单）

接收交易指令（文本/JSON/邮件/钉钉/Telegram）

执行并回报成交（反馈到决策层）

监控与回测层

拉格朗日日志、绩效指标、回测引擎（策略历史表现）

实盘与回测结果比对、策略稳定性检验

二、职责划分（明确界限）

我（agent）输出：明确、可机器解析的交易信号（JSON），包含：标的代码、方向（买/卖/减仓/清仓）、数量或目标仓位、下单类型、止损价、止盈价、信号理由与置信度（A/B/C）。

你（执行）仅负责：按信号下单并把实际成交回执回传（时间、成交价、成交量、委托ID）。

风控：默认由agent预检（并建议），但最终风控/交易权限由你掌握（你可以阻止任意信号）。

三、信号体系（策略示例，后续可扩展）

下面给一个偏短中期趋势的“可执行规则”作为MVP（以你之前主攻的光模块 + AI为主线可加入板块白名单）。

Universe：自选 + 行业轮动（光模块相关票）

入场（A类信号 — 强买入）：

日线：最近20日内横盘构筑平台，突破平台阻力且当天放量（成交量 > 过去20日均量的1.5倍）

周线：周线多头且与行业ETF/大盘相对强势

资金面：连续3日净流入或有龙虎榜集中买入（可选）

出场（止损/止盈与信号）：

固定止损：买入后下探至买入价 - X%（默认8%）触发止损。

动态移动止损：单股盈利 > Y%（默认10%）后移动止损至成本+Z%（默认3%）或用ATR-based trailing。

强烈反向信号（B类）：日线跌破N日均线并成放量下跌，触发离场。

仓位分配（示例）

组合最大仓位（股票市值占总资金）上限：80%（主升阶段）；分歧期或不确定期可切换。

单股目标仓位 = (组合可用仓位) × 分数（按信号置信度：A=0.15, B=0.08, C=0.03）

单股最大仓位不超过总资金的30%（防止重仓单票）

最后一级风险：若组合回撤 > 总资金的指定阈值（默认15%），触发减仓或全部止盈保护。

四、交互格式（机器友好）

每条信号用 JSON 发给你，